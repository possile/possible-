<script>

/* ===== GET NAME FROM URL ===== */
const urlParams = new URLSearchParams(window.location.search);
let name = urlParams.get("name");

if (name) {
  name = name.charAt(0).toUpperCase() + name.slice(1).toLowerCase();
} else {
  name = "My Friend";
}

/* üî• REMOVE NAME FROM ADDRESS BAR */
window.history.replaceState({}, document.title, window.location.pathname);

/* ===== CHANGE PHOTO BASED ON NAME ===== */
const photo = document.getElementById("valentinePhoto");
photo.src = name.toLowerCase() + ".jpg";
photo.onerror = function(){
  this.src = "default.jpg";
};

/* ===== ELEMENTS ===== */
const yesBtn = document.getElementById("yesBtn");
const noBtn = document.getElementById("noBtn");
const revealBox = document.getElementById("revealBox");
const questionBox = document.getElementById("questionBox");
const music = document.getElementById("bgMusic");
const typingQuestion = document.getElementById("typingQuestion");
const typedMessage = document.getElementById("typedMessage");
const buttonsWrapper = document.getElementById("buttonsWrapper");
const revealTitle = document.getElementById("revealTitle");

let yesSize = 1;

/* Funny NO Messages */
const funnyMessages = [
"Are you sure? üòè",
"Think again üëÄ",
"Wrong answer üòÇ",
"Try pressing YES instead üíï",
"You can't escape üòé",
"Still no? Brave move üòÜ"
];

/* Typing Function */
function typeText(element, text, speed, callback){
  let i = 0;
  element.innerHTML = "";
  function typing(){
    if(i < text.length){
      element.innerHTML += text.charAt(i);
      i++;
      setTimeout(typing, speed);
    }else if(callback){
      callback();
    }
  }
  typing();
}

/* Intro Question (NO NAME HERE) */
typeText(
  typingQuestion,
  "Will you be my Valentine? üíù",
  80,
  ()=>{
    buttonsWrapper.style.opacity="1";
    yesBtn.classList.add("pop");
    setTimeout(()=>{ noBtn.classList.add("pop"); },400);
  }
);

/* Move NO Button */
function moveNoButton(){

  if (navigator.vibrate) {
    navigator.vibrate([100,50,100]);
  }

  const randomMessage = funnyMessages[Math.floor(Math.random()*funnyMessages.length)];
  noBtn.innerText = randomMessage;

  yesSize += 0.15;
  yesBtn.style.transform = `scale(${yesSize})`;

  const padding = 20;
  const maxX = window.innerWidth - noBtn.offsetWidth - padding;
  const maxY = window.innerHeight - noBtn.offsetHeight - padding;

  noBtn.style.position = "fixed";
  noBtn.style.left = Math.random() * maxX + "px";
  noBtn.style.top = Math.random() * maxY + "px";
}

noBtn.addEventListener("mouseenter", moveNoButton);
noBtn.addEventListener("touchstart", function(e){
  e.preventDefault();
  moveNoButton();
});
noBtn.addEventListener("click", moveNoButton);

/* YES CLICK */
yesBtn.addEventListener("click",()=>{
  questionBox.style.display="none";
  revealBox.style.display="block";

  revealTitle.innerText = `Happy Valentine‚Äôs Day, ${name}! üíñ`;

  photo.classList.add("beat");

  music.volume=0.7;
  music.play();

  typeText(
    typedMessage,
`So ${name}‚Ä¶ this isn‚Äôt about anything too serious üòä

I just wanted to celebrate the day and show some love.

Whether as friends or just two people enjoying good vibes,
I‚Äôm really glad you‚Äôre in my life.

So being my Valentine today simply means
sharing smiles, laughter, and positive energy üíï`,
    40
  );

  launchConfetti();
});

/* Floating Hearts */
function createHeart(){
  const heart=document.createElement("div");
  heart.classList.add("heart");
  heart.innerHTML=Math.random()>.5?"üíñ":"‚ù§Ô∏è";
  heart.style.left=Math.random()*100+"vw";
  heart.style.fontSize=(20+Math.random()*30)+"px";
  document.body.appendChild(heart);
  setTimeout(()=>heart.remove(),5000);
}
setInterval(createHeart,500);

/* Confetti */
const canvas=document.getElementById("confetti");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

function launchConfetti(){
  const particles=[];
  for(let i=0;i<250;i++){
    particles.push({
      x:Math.random()*canvas.width,
      y:Math.random()*canvas.height,
      size:Math.random()*8+4,
      color:`hsl(${Math.random()*360},100%,70%)`,
      vx:Math.random()*6-3,
      vy:Math.random()*-8-4,
      gravity:.2
    });
  }

  function animate(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles.forEach(p=>{
      p.vy+=p.gravity;
      p.x+=p.vx;
      p.y+=p.vy;
      ctx.fillStyle=p.color;
      ctx.fillRect(p.x,p.y,p.size,p.size);
    });
    requestAnimationFrame(animate);
  }
  animate();
}

</script>
